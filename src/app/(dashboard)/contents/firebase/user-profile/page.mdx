# ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ç®¡ç†

> ğŸ“Œ **ã“ã®è¨˜äº‹ã§å­¦ã¶ã“ã¨**
>
> - Firestore ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜
> - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†
> - updateProfile

## Firestore ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜

Firebase Auth ã«ã¯æœ€ä½é™ã®æƒ…å ±ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚
è©³ç´°ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¯ **Firestore** ã«ä¿å­˜ã—ã¾ã™ã€‚

> ğŸ’¡ **ãªãœ Auth ã¨ Firestore ä¸¡æ–¹ã«ä¿å­˜ã™ã‚‹ï¼Ÿ**
>
> - **Firebase Auth**: èªè¨¼æƒ…å ±ï¼ˆãƒ¡ãƒ¼ãƒ«ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ï¼‰ã®ã¿ä¿å­˜
> - **Firestore**: è¿½åŠ æƒ…å ±ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€è‡ªå·±ç´¹ä»‹ã€è¨­å®šãªã©ï¼‰ã‚’ä¿å­˜
>
> Auth ã«ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã§ããªã„ãŸã‚ã€Firestore ã‚’ä½µç”¨ã—ã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```
users/
  {userId}/
    email: "tanaka@example.com"
    displayName: "ç”°ä¸­å¤ªéƒ"
    bio: "React ãŒå¥½ãã§ã™"
    photoURL: "https://..."
    createdAt: Timestamp
    updatedAt: Timestamp
```

## ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—

```jsx
import { doc, getDoc } from "firebase/firestore";
import { db } from "./lib/firebase";
import { useAuth } from "./contexts/AuthContext";

function useUserProfile() {
  const { currentUser } = useAuth();
  const [profile, setProfile] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!currentUser) {
      setProfile(null);
      setLoading(false);
      return;
    }

    const fetchProfile = async () => {
      const docRef = doc(db, "users", currentUser.uid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        setProfile({ id: docSnap.id, ...docSnap.data() });
      }
      setLoading(false);
    };

    fetchProfile();
  }, [currentUser]);

  return { profile, loading };
}
```

## ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†

```jsx
import { doc, updateDoc, serverTimestamp } from "firebase/firestore";
import { db } from "./lib/firebase";
import { useAuth } from "./contexts/AuthContext";

function ProfileEditForm() {
  const { currentUser } = useAuth();
  const [displayName, setDisplayName] = useState("");
  const [bio, setBio] = useState("");
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      await updateDoc(doc(db, "users", currentUser.uid), {
        displayName,
        bio,
        updatedAt: serverTimestamp(),
      });
      alert("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ");
    } catch (error) {
      console.error("æ›´æ–°ã‚¨ãƒ©ãƒ¼:", error);
      alert("æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ");
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <div>
        <label>è¡¨ç¤ºå</label>
        <input
          value={displayName}
          onChange={(e) => setDisplayName(e.target.value)}
        />
      </div>
      <div>
        <label>è‡ªå·±ç´¹ä»‹</label>
        <textarea value={bio} onChange={(e) => setBio(e.target.value)} />
      </div>
      <button type="submit" disabled={loading}>
        {loading ? "ä¿å­˜ä¸­..." : "ä¿å­˜"}
      </button>
    </form>
  );
}
```

## Firebase Auth ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°

Firebase Auth è‡ªä½“ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚‚æ›´æ–°ã§ãã¾ã™ã€‚

```javascript
import { updateProfile } from "firebase/auth";
import { auth } from "./lib/firebase";

const updateAuthProfile = async (displayName, photoURL) => {
  await updateProfile(auth.currentUser, {
    displayName,
    photoURL,
  });
};
```

## Auth ã¨ Firestore ã®åŒæœŸ

ä¸¡æ–¹ã‚’åŒæ™‚ã«æ›´æ–°ã™ã‚‹å ´åˆï¼š

```javascript
const updateUserProfile = async (displayName, bio) => {
  // 1. Firebase Auth ã‚’æ›´æ–°
  await updateProfile(auth.currentUser, { displayName });

  // 2. Firestore ã‚’æ›´æ–°
  await updateDoc(doc(db, "users", auth.currentUser.uid), {
    displayName,
    bio,
    updatedAt: serverTimestamp(),
  });
};
```

## ã¾ã¨ã‚

- è©³ç´°ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¯ **Firestore** ã«ä¿å­˜
- **updateDoc** ã§ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°
- **updateProfile** ã§ Firebase Auth ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚‚æ›´æ–°å¯èƒ½
- ä¸¡æ–¹ã‚’åŒæœŸã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹

## ğŸ¯ ã‚„ã£ã¦ã¿ã‚ˆã†

> ğŸ’¡ **ãƒŸãƒ‹æ¼”ç¿’**
>
> 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚ã« Firestore ã«ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜ã—ã¦ã¿ã¾ã—ã‚‡ã†
> 2. `useUserProfile` ãƒ•ãƒƒã‚¯ã‚’ä½œæˆã—ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’å–å¾—
> 3. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã€`displayName` ã‚„ `bio` ã‚’æ›´æ–°ã§ãã‚‹ã‚ˆã†ã«
>
> **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: Firebase Console ã§ `users` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ç®¡ç†ãŒã§ããŸã‚‰ã€[Firebase Storage ã®åŸºç¤](./05-15_FirebaseStorageã®åŸºç¤.md) ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
