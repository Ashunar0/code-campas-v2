# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«å…¥é–€ã€ä»»æ„ã€‘

> ğŸ“Œ **ã“ã®è¨˜äº‹ã§å­¦ã¶ã“ã¨**
>
> - Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã¨ã¯
> - åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ã®æ›¸ãæ–¹
> - èªè¨¼ã¨ãƒ‡ãƒ¼ã‚¿æ‰€æœ‰æ¨©ã®ãƒã‚§ãƒƒã‚¯

> ğŸ’¡ ã“ã®è¨˜äº‹ã¯**ä»»æ„**ã§ã™ãŒã€æœ¬ç•ªé‹ç”¨ã§ã¯å¿…é ˆã®çŸ¥è­˜ã§ã™ã€‚

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã¨ã¯ï¼Ÿ

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«**ã¯ã€Firestore ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ãƒã‚§ãƒƒã‚¯ã¯çªç ´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€**ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰ã§ã‚‚å¿…ãšãƒã‚§ãƒƒã‚¯**ã—ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã®å•é¡Œ

Firebase Console ã§ã€Œãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã€ã‚’é¸ã¶ã¨ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã«ãªã‚Šã¾ã™ï¼š

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
```

**èª°ã§ã‚‚èª­ã¿æ›¸ãã§ãã¦ã—ã¾ã†ï¼**ï¼ˆå±é™ºï¼‰

## åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«

### èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /todos/{todoId} {
      allow read, write: if request.auth != null;
    }
  }
}
```

### è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /todos/{todoId} {
      // èª­ã¿å–ã‚Šï¼šèªè¨¼æ¸ˆã¿ & è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿
      allow read: if request.auth != null
                  && resource.data.userId == request.auth.uid;

      // ä½œæˆï¼šèªè¨¼æ¸ˆã¿ & userId ãŒè‡ªåˆ†
      allow create: if request.auth != null
                    && request.resource.data.userId == request.auth.uid;

      // æ›´æ–°ãƒ»å‰Šé™¤ï¼šèªè¨¼æ¸ˆã¿ & è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿
      allow update, delete: if request.auth != null
                            && resource.data.userId == request.auth.uid;
    }
  }
}
```

## ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è§£èª¬

| ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰              | æ„å‘³                       |
| ----------------------- | -------------------------- |
| `request.auth`          | èªè¨¼æƒ…å ±ï¼ˆnull = æœªèªè¨¼ï¼‰  |
| `request.auth.uid`      | ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID    |
| `resource.data`         | æ—¢å­˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ |
| `request.resource.data` | é€ä¿¡ã•ã‚Œã¦ããŸãƒ‡ãƒ¼ã‚¿       |

> ğŸ’¡ **request ã¨ resource ã®é•ã„**
>
> - **request**: ä»Šãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹æƒ…å ±ï¼ˆèªè¨¼æƒ…å ±ã€é€ä¿¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ï¼‰
> - **resource**: æ—¢ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å­˜åœ¨ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æƒ…å ±
>
> ä¾‹ï¼š`create` æ™‚ã¯ `resource` ã¯å­˜åœ¨ã—ãªã„ã®ã§ `request.resource.data` ã‚’ä½¿ã„ã¾ã™ã€‚

## Storage ã®ãƒ«ãƒ¼ãƒ«

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // users/{userId}/ é…ä¸‹ã¯æœ¬äººã®ã¿
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null
                         && request.auth.uid == userId;
    }

    // images/ ã¯èªè¨¼æ¸ˆã¿ãªã‚‰èª°ã§ã‚‚èª­ã¿æ›¸ãå¯
    match /images/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

## ãƒ«ãƒ¼ãƒ«ã®è¨­å®šæ–¹æ³•

1. Firebase Console ã‚’é–‹ã
2. **ã€ŒFirestore Databaseã€** â†’ **ã€Œãƒ«ãƒ¼ãƒ«ã€** ã‚¿ãƒ–
3. ãƒ«ãƒ¼ãƒ«ã‚’ç·¨é›†
4. **ã€Œå…¬é–‹ã€** ã‚’ã‚¯ãƒªãƒƒã‚¯

<!--
ğŸ“¸ ç”»åƒãƒ¡ãƒ¢: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ç·¨é›†ç”»é¢
-->

## ãƒ«ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆ

Firebase Console ã® **ã€Œãƒ«ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã€** ã§ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

1. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã‚’é¸æŠï¼ˆget, list, create ç­‰ï¼‰
2. èªè¨¼çŠ¶æ…‹ã‚’è¨­å®š
3. ãƒ‘ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›
4. ã€Œå®Ÿè¡Œã€ã§ãƒ†ã‚¹ãƒˆ

## ã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³

### users ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

```javascript
match /users/{userId} {
  // èª­ã¿å–ã‚Šï¼šèª°ã§ã‚‚
  allow read: if true;

  // æ›¸ãè¾¼ã¿ï¼šæœ¬äººã®ã¿
  allow write: if request.auth != null
               && request.auth.uid == userId;
}
```

### posts ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

```javascript
match /posts/{postId} {
  // èª­ã¿å–ã‚Šï¼šèª°ã§ã‚‚
  allow read: if true;

  // ä½œæˆï¼šèªè¨¼æ¸ˆã¿
  allow create: if request.auth != null;

  // æ›´æ–°ãƒ»å‰Šé™¤ï¼šä½œæˆè€…ã®ã¿
  allow update, delete: if request.auth != null
                        && resource.data.authorId == request.auth.uid;
}
```

## ã¾ã¨ã‚

- **ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã¯é–‹ç™ºç”¨**ã€æœ¬ç•ªã§ã¯å±é™º
- `request.auth` ã§èªè¨¼ãƒã‚§ãƒƒã‚¯
- `resource.data.userId` ã§æ‰€æœ‰æ¨©ãƒã‚§ãƒƒã‚¯
- ãƒ«ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆ

## ğŸ¯ ã‚„ã£ã¦ã¿ã‚ˆã†

> ğŸ’¡ **ãƒŸãƒ‹æ¼”ç¿’**
>
> 1. Firebase Console ã§ Firestore ã®ã€Œãƒ«ãƒ¼ãƒ«ã€ã‚¿ãƒ–ã‚’é–‹ã„ã¦ãã ã•ã„
> 2. èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿èª­ã¿æ›¸ãã§ãã‚‹ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®š
> 3. ã€Œãƒ«ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã€ã§ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†
>
> **ãƒ†ã‚¹ãƒˆä¾‹**: èªè¨¼ã‚ã‚Š/ãªã—ã§ãã‚Œãã‚Œã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹ç¢ºèª

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãŒã‚ã‹ã£ãŸã‚‰ã€[Firebase Hosting ã§ãƒ‡ãƒ—ãƒ­ã‚¤](./05-19_FirebaseHostingã§ãƒ‡ãƒ—ãƒ­ã‚¤.md) ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
