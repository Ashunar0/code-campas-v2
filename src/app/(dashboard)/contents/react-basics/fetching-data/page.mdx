# API ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹

> ğŸ“Œ **ã“ã®è¨˜äº‹ã§å­¦ã¶ã“ã¨**
>
> - useEffect ã¨ fetch ã®çµ„ã¿åˆã‚ã›
> - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ç®¡ç†
> - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
> - å®Ÿè·µä¾‹

## React ã§ã® API å–å¾—ãƒ‘ã‚¿ãƒ¼ãƒ³

React ã§ API ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```jsx
import { useState, useEffect } from "react";

function App() {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      try {
        const response = await fetch("https://api.example.com/data");
        const result = await response.json();
        setData(result);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);

  if (loading) return <p>èª­ã¿è¾¼ã¿ä¸­...</p>;
  if (error) return <p>ã‚¨ãƒ©ãƒ¼: {error}</p>;
  if (!data) return <p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>;

  return <div>{/* ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º */}</div>;
}
```

## 3 ã¤ã® State

API å–å¾—ã§ã¯ã€3 ã¤ã® State ã‚’ç®¡ç†ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚

| State     | å½¹å‰²               |
| --------- | ------------------ |
| `data`    | å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿     |
| `loading` | èª­ã¿è¾¼ã¿ä¸­ã‹ã©ã†ã‹ |
| `error`   | ã‚¨ãƒ©ãƒ¼æƒ…å ±         |

## å®Ÿè·µä¾‹ï¼šPokeAPI

```jsx
import { useState, useEffect } from "react";

function PokemonCard({ id }) {
  const [pokemon, setPokemon] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchPokemon = async () => {
      try {
        setLoading(true);
        const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);

        if (!response.ok) {
          throw new Error("ãƒã‚±ãƒ¢ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
        }

        const data = await response.json();
        setPokemon(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchPokemon();
  }, [id]); // id ãŒå¤‰ã‚ã£ãŸã‚‰å†å–å¾—

  if (loading) {
    return <p>èª­ã¿è¾¼ã¿ä¸­...</p>;
  }

  if (error) {
    return <p>ã‚¨ãƒ©ãƒ¼: {error}</p>;
  }

  return (
    <div className="pokemon-card">
      <img src={pokemon.sprites.front_default} alt={pokemon.name} />
      <h2>{pokemon.name}</h2>
      <p>No. {pokemon.id}</p>
      <p>é«˜ã•: {pokemon.height / 10}m</p>
      <p>é‡ã•: {pokemon.weight / 10}kg</p>
    </div>
  );
}

export default PokemonCard;
```

## ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œèª­ã¿è¾¼ã¿ä¸­ã€ã§ã‚ã‚‹ã“ã¨ã‚’ä¼ãˆã¾ã—ã‚‡ã†ã€‚

```jsx
if (loading) {
  return (
    <div className="loading">
      <div className="spinner"></div>
      <p>èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>
  );
}
```

### CSS ã§ã‚¹ãƒ”ãƒŠãƒ¼ã‚’ä½œã‚‹

```css
.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #3498db;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

API å–å¾—ã¯å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```jsx
useEffect(() => {
  const fetchData = async () => {
    try {
      const response = await fetch(url);

      // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ­£å¸¸ã‹ãƒã‚§ãƒƒã‚¯
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      setData(data);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  fetchData();
}, []);
```

## å®Ÿè·µä¾‹ï¼šãƒã‚±ãƒ¢ãƒ³ãƒªã‚¹ãƒˆ

```jsx
import { useState, useEffect } from "react";

function PokemonList() {
  const [pokemons, setPokemons] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchPokemons = async () => {
      try {
        const response = await fetch(
          "https://pokeapi.co/api/v2/pokemon?limit=20"
        );
        const data = await response.json();
        setPokemons(data.results);
      } catch (err) {
        console.error("ã‚¨ãƒ©ãƒ¼:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchPokemons();
  }, []);

  if (loading) {
    return <p>èª­ã¿è¾¼ã¿ä¸­...</p>;
  }

  return (
    <ul>
      {pokemons.map((pokemon, index) => (
        <li key={pokemon.name}>
          #{index + 1} {pokemon.name}
        </li>
      ))}
    </ul>
  );
}
```

## æ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…

```jsx
function PokemonSearch() {
  const [searchName, setSearchName] = useState("");
  const [pokemon, setPokemon] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const handleSearch = async () => {
    if (!searchName.trim()) return;

    setLoading(true);
    setError(null);
    setPokemon(null);

    try {
      const response = await fetch(
        `https://pokeapi.co/api/v2/pokemon/${searchName.toLowerCase()}`
      );

      if (!response.ok) {
        throw new Error("ãƒã‚±ãƒ¢ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
      }

      const data = await response.json();
      setPokemon(data);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <input
        type="text"
        value={searchName}
        onChange={(e) => setSearchName(e.target.value)}
        placeholder="ãƒã‚±ãƒ¢ãƒ³åã‚’å…¥åŠ›"
      />
      <button onClick={handleSearch} disabled={loading}>
        æ¤œç´¢
      </button>

      {loading && <p>æ¤œç´¢ä¸­...</p>}
      {error && <p>ã‚¨ãƒ©ãƒ¼: {error}</p>}
      {pokemon && (
        <div>
          <h2>{pokemon.name}</h2>
          <img src={pokemon.sprites.front_default} alt={pokemon.name} />
        </div>
      )}
    </div>
  );
}
```

## ã¾ã¨ã‚

- **useEffect** + **fetch** ã§ API ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
- 3 ã¤ã® Stateï¼š**data**, **loading**, **error**
- **ä¾å­˜é…åˆ—**ã§å†å–å¾—ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡
- **try-catch-finally** ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å‘ä¸Š

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

API å–å¾—ãŒã‚ã‹ã£ãŸã‚‰ã€[State ã®ãƒªãƒ•ãƒˆã‚¢ãƒƒãƒ—](./03-12_Stateã®ãƒªãƒ•ãƒˆã‚¢ãƒƒãƒ—.md) ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
