# マージの基礎

## この記事で学ぶこと

- マージとは何か
- git merge の使い方
- Fast-forward マージ
- 3-way マージ
- マージコミット

---

## マージとは

### ブランチを統合する

**マージ**とは、あるブランチの変更を別のブランチに取り込むことです。

```
                 feature/login
                      ↓
              ● ─── ● ─── ●
             /               \
● ─── ● ─── ● ─────────────── ● ─── ●  ← main
                              ↑
                          マージコミット
```

feature ブランチで開発した内容を main ブランチに統合します。

---

## git merge の基本

### マージの流れ

```bash
# 1. main ブランチに切り替え
git checkout main

# 2. 最新を取得
git pull origin main

# 3. feature ブランチをマージ
git merge feature/add-login
```

### コマンドの意味

```
git merge feature/add-login
          │
          └── マージしたいブランチ名

※ 現在いるブランチに、指定したブランチを取り込む
```

---

## Fast-forward マージ

### 分岐がない場合のマージ

main ブランチに新しいコミットがない場合、単純に main のポインタが feature の先端に移動します。

```
【マージ前】
main     ● ─── ● ─── ●
                      \
feature               ● ─── ● ─── ●

【マージ後】
main     ● ─── ● ─── ● ─── ● ─── ● ─── ●
                      ↑
                  元の main の位置
```

### Fast-forward の特徴

```
特徴：
├── マージコミットが作成されない
├── 履歴が一直線になる
├── シンプルでわかりやすい
└── 分岐がなかった場合にのみ発生
```

### 実際の出力

```bash
git merge feature/add-login

# 出力
Updating a1b2c3d..e4f5g6h
Fast-forward
 src/LoginForm.jsx | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)
```

---

## 3-way マージ

### 分岐がある場合のマージ

main ブランチにも新しいコミットがある場合、両方の変更を統合した新しいコミット（マージコミット）が作成されます。

```
【マージ前】
                 feature
                    ↓
              ● ─── ●
             /
● ─── ● ─── ● ─── ●
                   ↑
                  main

【マージ後】
              ● ─── ●
             /       \
● ─── ● ─── ● ─── ● ─── ●  ← マージコミット
                         ↑
                        main
```

### 3-way の意味

```
3つのポイントを比較：
├── 共通の祖先コミット（分岐点）
├── main の最新コミット
└── feature の最新コミット

これらを比較して、自動的に統合
```

### 実際の出力

```bash
git merge feature/add-login

# 出力
Merge made by the 'ort' strategy.
 src/LoginForm.jsx | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)
```

---

## マージコミット

### マージコミットとは

3-way マージで作成される、2つの親を持つ特別なコミットです。

```bash
git log --oneline --graph

# 出力
*   e4f5g6h (HEAD -> main) Merge branch 'feature/add-login'
|\
| * c3d4e5f ログインフォームを作成
| * b2c3d4e バリデーションを追加
|/
* a1b2c3d ヘッダーを修正
* 9z8y7x6 初期コミット
```

### マージコミットメッセージ

デフォルトでは自動的にメッセージが作成されます：

```
Merge branch 'feature/add-login' into main
```

カスタマイズする場合：

```bash
git merge feature/add-login -m "ログイン機能を追加 (#12)"
```

---

## ローカルでマージ vs GitHub でマージ

### ローカルでマージ

```bash
# 自分の PC でマージ
git checkout main
git merge feature/add-login
git push origin main
```

```
使用シーン：
├── 個人開発
├── 小さな変更
└── すぐにマージしたい場合
```

### GitHub でマージ（Pull Request）

```
1. feature ブランチを push
2. GitHub で Pull Request を作成
3. レビューを受ける
4. GitHub 上で「Merge」ボタンをクリック
```

```
使用シーン：
├── チーム開発（推奨）
├── コードレビューが必要な場合
├── 変更履歴を明確に残したい場合
└── CI/CD を通したい場合
```

📸 画像メモ: GitHub の Merge ボタン

---

## マージ後のブランチ削除

### なぜ削除するのか

マージが完了したブランチは用済みです。削除して整理しましょう。

```
メリット：
├── ブランチ一覧がすっきり
├── 何が作業中かわかりやすい
└── 古いブランチと間違えない
```

### ローカルブランチの削除

```bash
# マージ済みブランチを削除
git branch -d feature/add-login

# 強制削除（マージしていなくても削除）
git branch -D feature/add-login
```

### リモートブランチの削除

```bash
# リモートブランチを削除
git push origin --delete feature/add-login
```

GitHub の Pull Request 画面からも削除できます。

📸 画像メモ: GitHub の「Delete branch」ボタン

---

## 実践：ブランチのマージ

### シナリオ

feature/add-footer ブランチを main にマージします。

### 1. 現在の状態を確認

```bash
git branch
# * feature/add-footer
#   main

git log --oneline
# a1b2c3d フッターを作成
# 9z8y7x6 初期コミット
```

### 2. main に切り替え

```bash
git checkout main
git pull origin main
```

### 3. マージ

```bash
git merge feature/add-footer
```

### 4. プッシュ

```bash
git push origin main
```

### 5. ブランチを削除

```bash
# ローカル
git branch -d feature/add-footer

# リモート
git push origin --delete feature/add-footer
```

---

## マージの種類まとめ

| 種類 | 条件 | 結果 |
|:----|:----|:----|
| Fast-forward | main に新しいコミットがない | ポインタが移動するだけ |
| 3-way merge | 両方に新しいコミットがある | マージコミットが作成される |

---

## まとめ

マージを使って、ブランチの変更を main に統合できます。

### 基本コマンド

| コマンド | 説明 |
|:--------|:-----|
| `git merge <branch>` | ブランチをマージ |
| `git branch -d <branch>` | ブランチを削除 |
| `git log --graph` | グラフで履歴を表示 |

### マージの流れ

```
1. main ブランチに切り替え
2. git pull で最新を取得
3. git merge でブランチをマージ
4. git push で main をプッシュ
5. 不要なブランチを削除
```

次の記事では、チーム開発で重要な Pull Request について学びます。

---

## 次の記事へ

[06-07. Pull Request の基礎](./06-07_PullRequestの基礎.md)
