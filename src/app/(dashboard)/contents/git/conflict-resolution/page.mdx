
## この記事で学ぶこと

- コンフリクト（conflict）とは何か
- なぜコンフリクトが起きるのか
- コンフリクトの解決方法
- VSCode でのコンフリクト解決
- よくある間違いと対処法

---

## コンフリクトとは

### 定義

**コンフリクト（conflict: 競合）**とは、Git がどちらの変更を採用すべきか自動で判断できない状態のことです。

これは2つのブランチで**同じファイルの同じ箇所**を変更したときに発生します。

```
Aさん：「Hello」→「こんにちは」に変更
Bさん：「Hello」→「Hi there!」に変更
  ↓
Git：「どちらを採用すればいいの？」
  ↓
コンフリクト発生！人間が判断する必要がある
```

### なぜコンフリクトが起きるのか

```
発生する場面：
├── 同じファイルの同じ行を2人が編集
├── 片方がファイルを削除、もう片方が編集
├── 同じ箇所に別々の内容を追加
└── マージ・プル時に検出される

発生しない場面：
├── 別のファイルを編集
├── 同じファイルでも別の行を編集
└── 片方がファイルを追加（新規作成）
```

> **安心してください**: コンフリクトはエラーではなく、Git からの「確認依頼」です。焦らず解決手順に従えば問題ありません。

---

## コンフリクトマーカーを理解する

コンフリクトが発生すると、Git はファイルに特殊なマーカーを挿入します。

### マーカーの読み方

```javascript
function greet() {
<<<<<<< HEAD
  console.log("こんにちは");
=======
  console.log("Hi there!");
>>>>>>> feature/update-greeting
}
```

| マーカー | 意味 |
|:--------|:----|
| `<<<<<<< HEAD` | 現在のブランチ（自分の変更）の開始 |
| `=======` | 区切り線（ここから相手の変更） |
| `>>>>>>> branch-name` | マージ元ブランチの変更の終了 |

### 図解

```
<<<<<<< HEAD          ← 自分の変更の開始
  自分が書いたコード
=======               ← ここから相手の変更
  相手が書いたコード
>>>>>>> branch-name   ← 相手の変更の終了
```

📸 画像メモ: VSCode のコンフリクト表示画面（マーカーがハイライトされた状態）

---

## コンフリクトの解決方法

### 解決の選択肢

コンフリクトを解決するには、以下のいずれかを選択します：

| 選択肢 | 説明 | 使う場面 |
|:------|:----|:--------|
| 自分の変更を採用 | HEAD（現在のブランチ）の内容を使う | 自分の変更が正しい場合 |
| 相手の変更を採用 | マージ元ブランチの内容を使う | 相手の変更が正しい場合 |
| 両方を採用 | 両方の変更を残す | 両方とも必要な場合 |
| 手動で編集 | 自分で最適な内容を書く | 両方を組み合わせたい場合 |

### 手順（コマンドライン）

```bash
# 1. コンフリクトがあるファイルを確認
git status

# 出力例
# Unmerged paths:
#   both modified:   src/greet.js

# 2. ファイルを開いて編集（マーカーを削除して正しい内容にする）

# 3. 解決したファイルをステージング
git add src/greet.js

# 4. マージコミットを作成
git commit -m "Merge conflict resolved"

# 5. プッシュ
git push
```

### 解決例

**元のコンフリクト:**
```javascript
function greet() {
<<<<<<< HEAD
  console.log("こんにちは");
=======
  console.log("Hi there!");
>>>>>>> feature/update-greeting
}
```

**解決後（両方を組み合わせる場合）:**
```javascript
function greet(language) {
  if (language === "ja") {
    console.log("こんにちは");
  } else {
    console.log("Hi there!");
  }
}
```

> **重要**: マーカー（`<<<<<<<`, `=======`, `>>>>>>>`）は必ずすべて削除してください。残っているとエラーになります。

---

## VSCode でのコンフリクト解決

VSCode はコンフリクトを視覚的に表示し、ボタンクリックで解決できます。

### 解決ボタン

コンフリクトが発生すると、エディタ上部に以下のボタンが表示されます：

| ボタン | 動作 |
|:------|:----|
| Accept Current Change | 現在のブランチの変更を採用（自分の変更） |
| Accept Incoming Change | マージ元の変更を採用（相手の変更） |
| Accept Both Changes | 両方の変更を残す |
| Compare Changes | 差分を並べて比較 |

📸 画像メモ: VSCode のコンフリクト解決ボタン

### VSCode での解決手順

1. **コンフリクトファイルを開く**
   - Source Control パネルに「!」マークで表示される
   - クリックして開く

2. **解決方法を選択**
   - ボタンをクリックするか、手動で編集

3. **マーカーを確認**
   - すべてのマーカーが削除されていることを確認

4. **ステージングしてコミット**
   - Source Control パネルで「+」をクリック
   - コミットメッセージを入力してコミット

---

## 実践：コンフリクトを解決してみよう

### シナリオ

2つのブランチで同じファイルを編集し、意図的にコンフリクトを発生させて解決します。

### 1. 準備

```bash
# 新しいフォルダで試す
mkdir conflict-practice
cd conflict-practice
git init

# ファイルを作成
echo "Hello World" > greeting.txt
git add .
git commit -m "初期コミット"
```

### 2. ブランチを作成して編集

```bash
# feature ブランチを作成
git checkout -b feature/japanese

# ファイルを編集
echo "こんにちは" > greeting.txt
git add .
git commit -m "日本語に変更"

# main に戻る
git checkout main

# main でも同じファイルを編集
echo "Hi there!" > greeting.txt
git add .
git commit -m "英語の挨拶に変更"
```

### 3. マージしてコンフリクトを発生させる

```bash
git merge feature/japanese

# 出力
# Auto-merging greeting.txt
# CONFLICT (content): Merge conflict in greeting.txt
# Automatic merge failed; fix conflicts and then commit the result.
```

### 4. コンフリクトを確認

```bash
cat greeting.txt

# 出力
# <<<<<<< HEAD
# Hi there!
# =======
# こんにちは
# >>>>>>> feature/japanese
```

### 5. 解決する

ファイルを開いて、以下のように編集：

```
Hi there! / こんにちは
```

### 6. コミット

```bash
git add .
git commit -m "Merge conflict resolved"
```

🎉 コンフリクトを解決できました！

---

## よくある間違いと対処法

### 間違い1: マーカーを消し忘れる

**症状**: コミット後もファイルにマーカーが残っている

**対処法**:
```bash
# ファイルを確認
cat filename.txt

# マーカーが残っていたら編集して再コミット
git add .
git commit --amend
```

### 間違い2: 相手の変更を完全に消してしまう

**症状**: マージ後に相手の機能が動かない

**対処法**:
- マージ前に両方の変更内容を確認する
- `Compare Changes` ボタンで差分を見る
- 不安なときはチームメンバーに相談

### 間違い3: コンフリクト中に別の作業を始める

**症状**: 状態がさらに複雑になる

**対処法**:
- コンフリクト解決を完了してから次の作業へ
- 解決が難しい場合は `git merge --abort` で中止

---

## コンフリクトを避けるためのヒント

```
予防策：
├── こまめに pull する（1日1回以上）
├── 小さい単位で作業・マージ
├── ファイルを細かく分割する
├── 誰がどこを編集しているか共有
└── ブランチは早めにマージ
```

> **Tip**: コンフリクトは「チームで同時に作業している証拠」です。避けすぎず、解決スキルを磨くことも大切です。

---

## ミニ演習

### Try 1: コンフリクトを体験する

上記の「実践」セクションの手順を実際に試してみましょう。

**確認ポイント:**
- [ ] コンフリクトマーカーを確認できた
- [ ] VSCode の解決ボタンを使ってみた
- [ ] マーカーをすべて削除してコミットできた

### Try 2: チームメンバーとコンフリクトを起こす

ペアで以下を試してみましょう：

1. 同じリポジトリをクローン
2. 同じファイルの同じ行を別々に編集
3. 一人がプッシュ後、もう一人がプル
4. コンフリクトを解決

---

## まとめ

コンフリクトは正しく解決すれば問題ありません。焦らず手順に従いましょう。

### 解決手順

```
1. git status でコンフリクトファイルを確認
2. ファイルを開いてマーカーを確認
3. どの変更を採用するか決める
4. マーカーをすべて削除して編集
5. git add → git commit
```

### ポイント

```
✅ コンフリクト = Git からの確認依頼（エラーではない）
✅ マーカーは必ずすべて削除する
✅ 不安なときはチームメンバーに相談
✅ VSCode のボタンを活用すると楽
✅ 予防も大切（こまめな pull）
```

---

## 次の記事へ

06-10. コンフリクトを避けるための設計
