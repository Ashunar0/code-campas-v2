# Git のよく使うコマンド

## この記事で学ぶこと

- git diff（差分確認）
- git stash（一時保存）
- git reset（取り消し）
- git revert（打ち消し）
- その他の便利コマンド
- コマンドチートシート

---

## git diff（差分確認）

### いつ使うか

コミット前に「何を変更したか」を確認したいときに使います。

### 基本的な使い方

```bash
# ワーキングディレクトリの変更を確認
git diff

# ステージングした変更を確認
git diff --staged

# 特定ファイルの差分
git diff src/App.jsx

# 2つのブランチの差分
git diff main feature/login
```

### 出力の見方

```diff
--- a/src/App.jsx
+++ b/src/App.jsx
@@ -10,6 +10,7 @@
 function App() {
   return (
     <div>
-      <h1>Hello</h1>
+      <h1>Hello World</h1>
+      <p>Welcome!</p>
     </div>
   );
 }
```

| 記号 | 意味 |
|:----|:----|
| `-` | 削除された行（赤） |
| `+` | 追加された行（緑） |
| 空白 | 変更なし（コンテキスト） |

---

## git stash（一時保存）

### いつ使うか

作業途中だけど、別のブランチに切り替えたいときに使います。

```
こんな場面：
├── レビュー頼まれたけど、今の作業をコミットしたくない
├── main を pull したいけど、変更中のファイルがある
└── 別のブランチの修正を先にしたい
```

### 基本的な使い方

```bash
# 変更を一時保存
git stash

# 保存した変更を復元
git stash pop

# 一覧を確認
git stash list

# 特定の stash を適用（削除せず）
git stash apply stash@{0}

# stash を削除
git stash drop stash@{0}
```

### 使用例

```bash
# 作業中...
git status
# modified: src/App.jsx

# 一時保存してブランチ移動
git stash
git checkout main
git pull origin main

# 別のブランチで作業...

# 元のブランチに戻って復元
git checkout feature/my-work
git stash pop
```

### メッセージ付きで保存

```bash
# 何の作業かわかるようにメッセージをつける
git stash push -m "ログインフォームの作業中"

# 一覧で確認
git stash list
# stash@{0}: On feature/login: ログインフォームの作業中
```

---

## git reset（取り消し）

### いつ使うか

コミット前の操作を取り消したいときに使います。

### ステージングの取り消し

```bash
# 特定ファイルのステージングを取り消し
git reset HEAD ファイル名

# すべてのステージングを取り消し
git reset HEAD .

# または（Git 2.23+）
git restore --staged ファイル名
```

### コミットの取り消し

```bash
# 直前のコミットを取り消し（変更は残る）
git reset --soft HEAD~1

# 直前のコミットを取り消し（ステージングも解除）
git reset --mixed HEAD~1

# 直前のコミットを完全に取り消し（変更も消える）
git reset --hard HEAD~1
```

### オプションの違い

| オプション | ステージング | ファイル変更 | 使う場面 |
|:----------|:----------:|:----------:|:--------|
| `--soft` | 残る | 残る | コミットメッセージを直したい |
| `--mixed` | 解除 | 残る | コミットに含めるファイルを変えたい |
| `--hard` | 解除 | 消える | 完全にやり直したい |

> **⚠️ 注意**: `--hard` は変更が完全に消えます。復元できないので慎重に！

---

## git revert（打ち消し）

### いつ使うか

既にプッシュしたコミットを取り消したいときに使います。

### reset との違い

```
reset: 履歴を書き換える（過去を消す）
  ❌ プッシュ後は危険！

revert: 打ち消しコミットを追加（記録が残る）
  ✅ プッシュ後も安全
```

### 使い方

```bash
# 特定のコミットを打ち消し
git revert コミットID

# 例
git revert a1b2c3d

# 直前のコミットを打ち消し
git revert HEAD
```

### 実行結果

```bash
git log --oneline

# 出力
b2c3d4e Revert "バグのある変更"  ← 打ち消しコミット
a1b2c3d バグのある変更           ← 元のコミット
9z8y7x6 前のコミット
```

---

## その他の便利コマンド

### ファイルの変更を破棄

```bash
# 特定ファイルの変更を破棄
git checkout -- ファイル名

# または（Git 2.23+）
git restore ファイル名

# すべての変更を破棄
git restore .
```

### 直前のコミットを修正

```bash
# メッセージを修正
git commit --amend -m "新しいメッセージ"

# ファイルを追加してコミットし直し
git add 忘れたファイル
git commit --amend --no-edit
```

> **注意**: プッシュ後の `--amend` は危険です。ローカルのみで使用しましょう。

### 特定のファイルだけ元に戻す

```bash
# 特定のコミット時点のファイルを取得
git checkout コミットID -- ファイル名

# 例：前のコミットの状態に戻す
git checkout HEAD~1 -- src/App.jsx
```

---

## コマンドチートシート

### 基本

| コマンド | 説明 |
|:--------|:----|
| `git init` | リポジトリ初期化 |
| `git status` | 状態確認 |
| `git add .` | 全てステージング |
| `git commit -m "msg"` | コミット |
| `git log --oneline` | 履歴確認 |

### リモート

| コマンド | 説明 |
|:--------|:----|
| `git push` | プッシュ |
| `git pull` | プル |
| `git clone URL` | クローン |
| `git fetch` | リモートの情報を取得（マージせず） |

### ブランチ

| コマンド | 説明 |
|:--------|:----|
| `git branch` | ブランチ一覧 |
| `git checkout -b name` | ブランチ作成・切替 |
| `git switch -c name` | ブランチ作成・切替（新構文） |
| `git merge branch` | マージ |
| `git branch -d name` | ブランチ削除 |

### 差分・確認

| コマンド | 説明 |
|:--------|:----|
| `git diff` | 差分確認 |
| `git diff --staged` | ステージング済みの差分 |
| `git show` | 最新コミットの詳細 |

### 取り消し・修正

| コマンド | 説明 |
|:--------|:----|
| `git reset --soft HEAD~1` | コミット取り消し（変更残る） |
| `git reset --hard HEAD~1` | コミット取り消し（変更消える） |
| `git revert ID` | コミット打ち消し |
| `git stash` | 一時保存 |
| `git stash pop` | 一時保存を復元 |
| `git commit --amend` | 直前のコミットを修正 |

---

## ミニ演習

### Try 1: git diff を使ってみる

1. ファイルを編集する
2. `git diff` で差分を確認
3. `git add` でステージング
4. `git diff --staged` でステージング済みの差分を確認

### Try 2: git stash を使ってみる

1. ファイルを編集する（コミットせず）
2. `git stash` で一時保存
3. `git status` で何もないことを確認
4. 別のブランチに移動（`git checkout main`）
5. 元のブランチに戻る
6. `git stash pop` で復元
7. 編集内容が戻っていることを確認

### Try 3: git reset を試す

1. ファイルを編集してコミット
2. `git log --oneline` で確認
3. `git reset --soft HEAD~1` でコミット取り消し
4. `git status` で変更がステージングに戻っていることを確認

---

## まとめ

| やりたいこと | コマンド |
|:-----------|:--------|
| 変更を確認したい | `git diff` |
| 作業を一時保存したい | `git stash` |
| ステージングを取り消したい | `git reset HEAD .` |
| コミットを取り消したい（ローカル） | `git reset --soft HEAD~1` |
| コミットを取り消したい（プッシュ後） | `git revert コミットID` |
| コミットメッセージを修正したい | `git commit --amend -m "msg"` |

### ポイント

```
✅ プッシュ前は reset が使える
✅ プッシュ後は revert を使う
✅ stash は一時保存に便利
✅ --hard は慎重に使う
✅ 迷ったら git status で確認
```

---

## 次の記事へ

[06-13. GitHub の便利機能](./06-13_GitHubの便利機能.md)
