# コードレビューの基礎

## この記事で学ぶこと

- コードレビューとは
- レビューで見るポイント
- レビューコメントの書き方
- 建設的なフィードバック
- レビューを受けた後の対応

---

## コードレビューとは

### なぜコードレビューをするのか

**コードレビュー**は、他の人が書いたコードを確認し、フィードバックを与えるプロセスです。

```
目的：
├── バグや問題の早期発見
├── コード品質の向上
├── 知識の共有
├── 命名規則・コード規約の統一
└── チーム全体のスキルアップ
```

### レビューする人・される人

| 役割 | 説明 |
|:----|:----|
| レビュイー | コードを書いた人（レビューを受ける人） |
| レビュアー | コードを確認する人（レビューする人） |

---

## レビューで見るポイント

### 1. 機能が正しく動くか

```
確認すること：
├── 要件を満たしているか
├── エッジケースは考慮されているか
├── エラー処理は適切か
└── セキュリティ上の問題はないか
```

### 2. コードの可読性

```
確認すること：
├── 読みやすいか
├── 複雑すぎないか
├── 適切にコメントがあるか
└── ロジックが理解しやすいか
```

### 3. 命名規則

```
確認すること：
├── 変数名は意味がわかるか
├── 関数名は動作を表しているか
├── 一貫性があるか
└── 省略しすぎていないか
```

**良い例:**
```javascript
// ✅ 意味がわかる
const isLoggedIn = true;
const userList = [];
function calculateTotalPrice() {}
```

**悪い例:**
```javascript
// ❌ 意味がわからない
const flag = true;
const data = [];
function calc() {}
```

### 4. コードの構造

```
確認すること：
├── 関数が大きすぎないか
├── 責任が適切に分割されているか
├── 再利用しやすいか
└── DRY 原則を守っているか
```

---

## GitHub でのレビュー方法

### 1. PR の「Files changed」タブを開く

変更されたファイルの差分が表示されます。

📸 画像メモ: Files changed タブ

### 2. コメントを追加

1. コメントしたい行にカーソルを合わせる
2. 青い「+」ボタンをクリック
3. コメントを入力
4. 「Add single comment」または「Start a review」

📸 画像メモ: 行コメントの追加

### 3. レビューを送信

1. 右上の「Review changes」ボタンをクリック
2. 全体的なコメントを入力
3. レビュー結果を選択
4. 「Submit review」

---

## レビュー結果の種類

| 結果 | 意味 | 使う場面 |
|:----|:----|:--------|
| **Comment** | コメントのみ | 質問や軽い指摘 |
| **Approve** | 承認 | 問題なし、マージOK |
| **Request changes** | 修正依頼 | 修正が必要 |

📸 画像メモ: Review changes ダイアログ

---

## レビューコメントの書き方

### 良いコメントの特徴

```
✅ 具体的である
✅ 建設的である
✅ 理由を説明している
✅ 改善案を提示している
✅ 敬意を持っている
```

### コメントの例

**LGTM（良い場合）:**
```
LGTM! 👍
シンプルでわかりやすい実装ですね。
```

**軽い提案:**
```
nit: ここは三項演算子を使うとスッキリするかもしれません。

// 現在
if (isActive) {
  return "active";
} else {
  return "inactive";
}

// 提案
return isActive ? "active" : "inactive";
```

**質問:**
```
質問: この処理が必要な理由を教えていただけますか？
理解不足かもしれませんが、なぜ2回ループしているのでしょうか。
```

**修正依頼:**
```
ここは修正が必要です。
空配列の場合にエラーになる可能性があります。

// 提案
const firstItem = items.length > 0 ? items[0] : null;
```

### 避けるべきコメント

```
❌ 「これはダメ」（理由がない）
❌ 「なんでこんな書き方するの？」（攻撃的）
❌ 「普通はこうしない」（曖昧）
❌ 「。。。」（意味がわからない）
```

---

## 建設的なフィードバック

### 1. 人ではなくコードを評価

```
❌ 「あなたのコードは...」
✅ 「このコードは...」

❌ 「なんでこんな書き方をするの？」
✅ 「この書き方だと〜の懸念があります」
```

### 2. 質問形式を活用

```
「〜してください」
  ↓
「〜した方が良いと思うのですが、いかがでしょうか？」
```

### 3. 良い点も指摘する

```
良い点も積極的にコメント：
├── 「このロジック、きれいですね！」
├── 「リファクタリングありがとうございます」
└── 「テストケースが充実していて素晴らしい」
```

### 4. プレフィックスを活用

| プレフィックス | 意味 |
|:--------------|:----|
| `nit:` | 細かい指摘（必須ではない） |
| `suggestion:` | 提案 |
| `question:` | 質問 |
| `important:` | 重要な指摘 |

---

## レビューを受けた後の対応

### 1. コメントに対応

```
対応の流れ：
├── コメントを読んで理解する
├── 必要に応じて質問・議論する
├── コードを修正する
├── 新しいコミットをプッシュ
└── 対応状況を返信
```

### 2. 対応の返信

```
修正した場合：
「修正しました ✅」

議論が必要な場合：
「ご指摘ありがとうございます。
〜という理由でこの実装にしていますが、いかがでしょうか？」

確認した場合：
「確認しました。次回から気をつけます 🙏」
```

### 3. Resolve conversation

対応が完了したら「Resolve conversation」をクリックして、コメントを解決済みにします。

📸 画像メモ: Resolve conversation ボタン

---

## レビューの注意点

### レビュアー向け

```
心構え：
├── 完璧を求めすぎない
├── タイムリーにレビューする
├── コードスタイルは自動化に任せる
├── 重要な問題に集中する
└── 相手の立場を考える
```

### レビュイー向け

```
心構え：
├── フィードバックを個人攻撃と受け取らない
├── 謙虚に受け入れる
├── わからなければ質問する
├── 学びの機会として活用する
└── 感謝を伝える
```

---

## 実践：レビューしてみよう

### シナリオ

チームメンバーの PR をレビューします。

### レビュー対象のコード

```javascript
// ユーザー一覧を取得する関数
function f(x) {
  var data = [];
  for (var i = 0; i < x.length; i++) {
    data.push({
      name: x[i].name,
      email: x[i].email
    });
  }
  return data;
}
```

### レビューコメント例

```markdown
こちらにフィードバックいたします。

1. **関数名と引数名**
   `f` と `x` では何をする関数かわかりません。
   提案: `formatUsers(users)` のような名前はいかがでしょうか。

2. **変数宣言**
   `var` ではなく `const`/`let` を使いましょう。

3. **モダンな書き方**
   `map` を使うとシンプルになります：

   ```javascript
   const formatUsers = (users) => {
     return users.map(user => ({
       name: user.name,
       email: user.email
     }));
   };
   ```

全体的なロジックは問題ないと思います！👍
```

---

## まとめ

コードレビューは、品質向上とチーム成長のための重要なプロセスです。

### レビューのポイント

```
見るべき点：
├── 機能が正しく動くか
├── コードの可読性
├── 命名規則
└── 構造・設計
```

### 心構え

```
レビュアー：
├── 建設的なフィードバック
├── 理由と改善案を示す
├── 良い点も指摘する

レビュイー：
├── 謙虚に受け入れる
├── わからなければ質問
├── 学びの機会として活用
```

次の記事では、コンフリクト（競合）の理解と解決について学びます。

---

## 次の記事へ

[06-09. コンフリクトの理解と解決](./06-09_コンフリクトの理解と解決.md)
