# Todo ã‚¢ãƒ—ãƒªã« Firebase ã‚’çµ±åˆã—ã‚ˆã†ã€ãƒãƒ³ã‚ºã‚ªãƒ³ã€‘

> ğŸ“Œ **ã“ã®è¨˜äº‹ã§å­¦ã¶ã“ã¨**
>
> - localStorage ã‹ã‚‰ Firestore ã¸ã®ç§»è¡Œ
> - ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã®è¿½åŠ 
> - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã® Todo ç®¡ç†
> - ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å…¬é–‹

## ã‚„ã‚‹ã“ã¨ã®æ¦‚è¦

Chapter 4 ã§ä½œã£ãŸ **ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¢ãƒ—ãƒªï¼ˆæœ¬æ ¼ç‰ˆï¼‰** ã‚’ Firebase å¯¾å¿œã«ã—ã¾ã™ã€‚

| å¤‰æ›´å‰       | å¤‰æ›´å¾Œ           |
| ------------ | ---------------- |
| localStorage | Firestore        |
| èªè¨¼ãªã—     | Firebase Auth    |
| ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ | ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å…¬é–‹ |

## Step 1: Firebase è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 

> ğŸ“ **ã“ã® Step ã§ã‚„ã‚‹ã“ã¨**: `src/lib/firebase.js` ã®ç¢ºèª

å‰ã®è¨˜äº‹ã§ä½œæˆã—ãŸ `src/lib/firebase.js` ã‚’ä½¿ã„ã¾ã™ã€‚

## Step 2: AuthContext ã‚’è¿½åŠ 

> ğŸ“ **ã“ã® Step ã§ã‚„ã‚‹ã“ã¨**: èªè¨¼çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ Context ã®ä½œæˆ

**src/contexts/AuthContext.jsx**ï¼ˆ05-12 ã§ä½œæˆæ¸ˆã¿ï¼‰

```jsx
import { createContext, useContext, useState, useEffect } from "react";
import { onAuthStateChanged } from "firebase/auth";
import { auth } from "../lib/firebase";

const AuthContext = createContext();

export function AuthProvider({ children }) {
  const [currentUser, setCurrentUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, (user) => {
      setCurrentUser(user);
      setLoading(false);
    });
    return unsubscribe;
  }, []);

  return (
    <AuthContext.Provider value={{ currentUser, loading }}>
      {!loading && children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  return useContext(AuthContext);
}
```

## Step 3: useTodos ã‚’ Firestore å¯¾å¿œã«ä¿®æ­£

> ğŸ“ **ã“ã® Step ã§ã‚„ã‚‹ã“ã¨**: localStorage ã‹ã‚‰ Firestore ã¸ã®ç§»è¡Œ

**src/hooks/useTodos.js**

```jsx
import { useState, useEffect } from "react";
import {
  collection,
  query,
  where,
  orderBy,
  onSnapshot,
  addDoc,
  updateDoc,
  deleteDoc,
  doc,
  serverTimestamp,
} from "firebase/firestore";
import { db } from "../lib/firebase";
import { useAuth } from "../contexts/AuthContext";

export function useTodos() {
  const { currentUser } = useAuth();
  const [todos, setTodos] = useState([]);
  const [loading, setLoading] = useState(true);

  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å–å¾—
  useEffect(() => {
    if (!currentUser) {
      setTodos([]);
      setLoading(false);
      return;
    }

    const q = query(
      collection(db, "todos"),
      where("userId", "==", currentUser.uid),
      orderBy("createdAt", "desc")
    );

    const unsubscribe = onSnapshot(q, (snapshot) => {
      const todosData = snapshot.docs.map((doc) => ({
        id: doc.id,
        ...doc.data(),
      }));
      setTodos(todosData);
      setLoading(false);
    });

    return unsubscribe;
  }, [currentUser]);

  // è¿½åŠ 
  const addTodo = async (text) => {
    await addDoc(collection(db, "todos"), {
      text,
      done: false,
      userId: currentUser.uid,
      createdAt: serverTimestamp(),
    });
  };

  // æ›´æ–°
  const updateTodo = async (id, updates) => {
    await updateDoc(doc(db, "todos", id), {
      ...updates,
      updatedAt: serverTimestamp(),
    });
  };

  // å‰Šé™¤
  const deleteTodo = async (id) => {
    await deleteDoc(doc(db, "todos", id));
  };

  // å®Œäº†åˆ‡ã‚Šæ›¿ãˆ
  const toggleTodo = async (id, currentDone) => {
    await updateDoc(doc(db, "todos", id), {
      done: !currentDone,
    });
  };

  return { todos, loading, addTodo, updateTodo, deleteTodo, toggleTodo };
}
```

## Step 4: ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ç™»éŒ²ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ 

> ğŸ“ **ã“ã® Step ã§ã‚„ã‚‹ã“ã¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ç”¨ã®ãƒšãƒ¼ã‚¸ä½œæˆ

**src/pages/Login.jsx**

```jsx
import { useState } from "react";
import { useNavigate, Navigate, Link } from "react-router-dom";
import { signInWithEmailAndPassword } from "firebase/auth";
import { auth } from "../lib/firebase";
import { useAuth } from "../contexts/AuthContext";

export default function Login() {
  const { currentUser } = useAuth();
  const navigate = useNavigate();
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);

  if (currentUser) {
    return <Navigate to="/" replace />;
  }

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError("");
    setLoading(true);

    try {
      await signInWithEmailAndPassword(auth, email, password);
      navigate("/");
    } catch (err) {
      setError("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="max-w-md mx-auto mt-20 p-6 bg-white rounded-lg shadow">
      <h1 className="text-2xl font-bold mb-6">ãƒ­ã‚°ã‚¤ãƒ³</h1>
      {error && <p className="text-red-500 mb-4">{error}</p>}
      <form onSubmit={handleSubmit} className="space-y-4">
        <input
          type="email"
          placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          className="w-full px-4 py-2 border rounded"
          required
        />
        <input
          type="password"
          placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          className="w-full px-4 py-2 border rounded"
          required
        />
        <button
          type="submit"
          disabled={loading}
          className="w-full py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
        >
          {loading ? "ãƒ­ã‚°ã‚¤ãƒ³ä¸­..." : "ãƒ­ã‚°ã‚¤ãƒ³"}
        </button>
      </form>
      <p className="mt-4 text-center">
        ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ã¯
        <Link to="/signup" className="text-blue-500 ml-1">
          æ–°è¦ç™»éŒ²
        </Link>
      </p>
    </div>
  );
}
```

## Step 5: App.jsx ã‚’æ›´æ–°

> ğŸ“ **ã“ã® Step ã§ã‚„ã‚‹ã“ã¨**: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨èªè¨¼ã‚¬ãƒ¼ãƒ‰ã®è¨­å®š

```jsx
import { BrowserRouter, Routes, Route } from "react-router-dom";
import { AuthProvider } from "./contexts/AuthContext";
import PrivateRoute from "./components/PrivateRoute";
import TodoApp from "./pages/TodoApp";
import Login from "./pages/Login";
import SignUp from "./pages/SignUp";

function App() {
  return (
    <AuthProvider>
      <BrowserRouter>
        <Routes>
          <Route path="/login" element={<Login />} />
          <Route path="/signup" element={<SignUp />} />
          <Route
            path="/"
            element={
              <PrivateRoute>
                <TodoApp />
              </PrivateRoute>
            }
          />
        </Routes>
      </BrowserRouter>
    </AuthProvider>
  );
}

export default App;
```

## Step 6: ãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã‚’è¿½åŠ 

> ğŸ“ **ã“ã® Step ã§ã‚„ã‚‹ã“ã¨**: UI ã®ä»•ä¸Šã’

```jsx
import { signOut } from "firebase/auth";
import { auth } from "../lib/firebase";
import { useAuth } from "../contexts/AuthContext";

function Header() {
  const { currentUser } = useAuth();

  const handleLogout = async () => {
    await signOut(auth);
  };

  return (
    <header className="flex justify-between items-center mb-6">
      <h1 className="text-2xl font-bold">ğŸ“ ã‚¿ã‚¹ã‚¯ç®¡ç†</h1>
      <div className="flex items-center gap-4">
        <span className="text-gray-600">{currentUser?.email}</span>
        <button
          onClick={handleLogout}
          className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
        >
          ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </button>
      </div>
    </header>
  );
}
```

## Step 7: ãƒ‡ãƒ—ãƒ­ã‚¤

> ğŸ“ **ã“ã® Step ã§ã‚„ã‚‹ã“ã¨**: Firebase Hosting ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npm run build
firebase deploy --only hosting
```

## å®Œæˆï¼

ã“ã‚Œã§ **Firebase å¯¾å¿œ Todo ã‚¢ãƒ—ãƒª** ã®å®Œæˆã§ã™ï¼

- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³
- âœ… Firestore ã§ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- âœ… Web ã«ãƒ‡ãƒ—ãƒ­ã‚¤

## ã¾ã¨ã‚

- **localStorage** â†’ **Firestore** ã«ç§»è¡Œ
- **Firebase Auth** ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
- **userId** ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- **Firebase Hosting** ã§ãƒ‡ãƒ—ãƒ­ã‚¤

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

Firebase çµ±åˆãŒã§ããŸã‚‰ã€[ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—](./05-23_ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—.md) ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
