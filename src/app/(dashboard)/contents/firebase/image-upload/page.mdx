
> ğŸ“Œ **ã“ã®è¨˜äº‹ã§å­¦ã¶ã“ã¨**
>
> - ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ UI
> - ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
> - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²æ—ã®è¡¨ç¤º

## ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ UI

```jsx
function ImageUpload() {
  const [file, setFile] = useState(null);

  const handleFileChange = (e) => {
    if (e.target.files[0]) {
      setFile(e.target.files[0]);
    }
  };

  return <input type="file" accept="image/*" onChange={handleFileChange} />;
}
```

## ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

é¸æŠã—ãŸç”»åƒã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã—ã¾ã™ï¼š

```jsx
function ImageUpload() {
  const [file, setFile] = useState(null);
  const [preview, setPreview] = useState(null);

  const handleFileChange = (e) => {
    const selectedFile = e.target.files[0];
    if (selectedFile) {
      setFile(selectedFile);
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã® URL ã‚’ä½œæˆ
      setPreview(URL.createObjectURL(selectedFile));
    }
  };

  return (
    <div>
      <input type="file" accept="image/*" onChange={handleFileChange} />
      {preview && (
        <img src={preview} alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" style={{ maxWidth: "200px" }} />
      )}
    </div>
  );
}
```

## å®Œå…¨ãªå®Ÿè£…

```jsx
import { useState } from "react";
import { ref, uploadBytesResumable, getDownloadURL } from "firebase/storage";
import { storage } from "./lib/firebase";

function ImageUpload({ onUpload }) {
  const [file, setFile] = useState(null);
  const [preview, setPreview] = useState(null);
  const [progress, setProgress] = useState(0);
  const [uploading, setUploading] = useState(false);
  const [error, setError] = useState(null);

  const handleFileChange = (e) => {
    const selectedFile = e.target.files[0];
    if (!selectedFile) return;

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (selectedFile.size > 5 * 1024 * 1024) {
      setError("ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯5MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„");
      return;
    }

    setError(null);
    setFile(selectedFile);
    setPreview(URL.createObjectURL(selectedFile));
  };

  const handleUpload = async () => {
    if (!file) return;

    setUploading(true);
    setProgress(0);

    const filename = `${Date.now()}_${file.name}`;
    const storageRef = ref(storage, `images/${filename}`);
    const uploadTask = uploadBytesResumable(storageRef, file);

    uploadTask.on(
      "state_changed",
      (snapshot) => {
        const prog = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        setProgress(prog);
      },
      (error) => {
        setError("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ");
        setUploading(false);
      },
      async () => {
        const url = await getDownloadURL(uploadTask.snapshot.ref);
        onUpload?.(url);
        setFile(null);
        setPreview(null);
        setProgress(0);
        setUploading(false);
      }
    );
  };

  return (
    <div className="image-upload">
      <input
        type="file"
        accept="image/*"
        onChange={handleFileChange}
        disabled={uploading}
      />

      {error && <p className="error">{error}</p>}

      {preview && (
        <div>
          <img src={preview} alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" style={{ maxWidth: "200px" }} />
          <button onClick={handleUpload} disabled={uploading}>
            {uploading ? "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­..." : "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"}
          </button>
        </div>
      )}

      {uploading && (
        <div className="progress-bar">
          <div style={{ width: `${progress}%` }} />
          <span>{Math.round(progress)}%</span>
        </div>
      )}
    </div>
  );
}
```

## ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã®æ›´æ–°

```jsx
function ProfileImageUpload() {
  const { currentUser } = useAuth();

  const handleUpload = async (imageUrl) => {
    // 1. Firestore ã‚’æ›´æ–°
    await updateDoc(doc(db, "users", currentUser.uid), {
      photoURL: imageUrl,
      updatedAt: serverTimestamp(),
    });

    // 2. Firebase Auth ã‚‚æ›´æ–°
    await updateProfile(auth.currentUser, {
      photoURL: imageUrl,
    });
  };

  return (
    <div>
      <h3>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’å¤‰æ›´</h3>
      <ImageUpload onUpload={handleUpload} />
    </div>
  );
}
```

## URL ã‚’ Firestore ã«ä¿å­˜

Todo ã«ã‚‚ç”»åƒã‚’æ·»ä»˜ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ï¼š

```jsx
const addTodoWithImage = async (text, imageUrl) => {
  await addDoc(collection(db, "todos"), {
    text,
    imageUrl: imageUrl || null, // ç”»åƒãŒãªã„å ´åˆã¯ null
    done: false,
    userId: currentUser.uid,
    createdAt: serverTimestamp(),
  });
};
```

## ã¾ã¨ã‚

- **ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ**ã¯ `<input type="file" />`
- **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ã¯ `URL.createObjectURL`
- **é€²æ—è¡¨ç¤º**ã¯ `uploadBytesResumable`
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã® **URL ã‚’ Firestore ã«ä¿å­˜**

## ğŸ¯ ã‚„ã£ã¦ã¿ã‚ˆã†

> ğŸ’¡ **ãƒŸãƒ‹æ¼”ç¿’**
>
> 1. ç”»åƒé¸æŠã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ã‚‡ã†
> 2. `uploadBytesResumable` ã§é€²æ—ãƒãƒ¼ã‚’è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†
> 3. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã® URL ã‚’ `<img>` ã‚¿ã‚°ã§è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†
>
> **ãƒãƒ£ãƒ¬ãƒ³ã‚¸**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒ 5MB ã‚’è¶…ãˆãŸã‚‰ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦ã¿ã‚ˆã†

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒã§ããŸã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç† ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
