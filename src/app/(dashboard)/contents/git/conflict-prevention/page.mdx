# コンフリクトを避けるための設計

## この記事で学ぶこと

- コンポーネント分割でコンフリクト回避
- ファイルごとに担当を分ける
- こまめにマージする重要性
- コミュニケーションの重要性
- チームでのルール策定

---

## なぜ設計段階で考えるのか

コンフリクトは解決できますが、**発生しにくい設計**をすることで開発効率が大幅に向上します。

```
コンフリクトが多いチーム：
├── 解決に時間がかかる
├── ストレスが溜まる
├── マージが怖くなる
└── 開発スピードが落ちる

コンフリクトが少ないチーム：
├── スムーズにマージできる
├── レビューに集中できる
├── 安心して開発できる
└── 開発スピードが上がる
```

---

## コンポーネント分割でコンフリクト回避

### React の強みを活かす

コンポーネントごとにファイルを分けることで、同じファイルを編集する確率を大幅に下げられます。

```
❌ 悪い例：1ファイルにすべて
src/
└── App.jsx  ← 全員がこのファイルを編集 → コンフリクト頻発

✅ 良い例：コンポーネントごとに分割
src/
├── App.jsx           ← 構成のみ
├── components/
│   ├── Header.jsx    ← Aさん担当
│   ├── TodoList.jsx  ← Bさん担当
│   ├── TodoItem.jsx  ← Bさん担当
│   └── Footer.jsx    ← Cさん担当
├── hooks/
│   └── useTodos.js   ← Cさん担当
└── lib/
    └── api.js        ← Aさん担当
```

### 分割の目安

```
1コンポーネント = 1ファイル の原則

分割するタイミング：
├── 50行を超えたら分割を検討
├── 再利用したくなったら分割
├── 別の責任を持つ部分は分割
└── 別の人が担当する部分は分割
```

---

## ファイルごとに担当を分ける

### 役割分担の例

```
チーム3人の場合：

Aさん（リーダー）
├── App.jsx
├── routes の設定
├── 全体のレイアウト
└── レビュー担当

Bさん（UI担当）
├── components/
├── スタイリング（CSS）
└── レスポンシブ対応

Cさん（データ担当）
├── hooks/（カスタムフック）
├── lib/（API連携）
└── Firebase 連携
```

### 担当を明確にする方法

| 方法 | 説明 |
|:----|:----|
| Issue にアサイン | 誰がどのタスクか明確 |
| Projects ボード | 進捗が可視化される |
| ファイル冒頭にコメント | 担当者がわかる |
| Slack/Discord で宣言 | リアルタイムで共有 |

```javascript
// components/Header.jsx
/**
 * ヘッダーコンポーネント
 * 担当: Aさん
 * 最終更新: 2024/01/15
 */
```

---

## こまめにマージする

### 長期間放置は危険

```
1週間放置したブランチ
  ↓
main が大きく変わっている
  ↓
大量のコンフリクト発生
  ↓
解決に時間がかかる
  ↓
怖くてマージできなくなる
```

### 推奨サイクル

```
理想的なサイクル：
├── 毎朝 main を pull する
├── 機能が完成したらすぐ PR を作成
├── 長くても3日以内にマージ
├── 大きな機能は小さく分割して段階的にマージ
└── WIP でも Draft PR で共有
```

### 大きな機能の分割例

```
❌ 悪い例：
「認証機能を追加」（1つの大きなPR）

✅ 良い例：
1. 「ログインフォームのUIを作成」（PR #1）
2. 「Firebase Auth を設定」（PR #2）
3. 「ログイン処理を実装」（PR #3）
4. 「ログアウト機能を追加」（PR #4）
5. 「認証状態の管理を追加」（PR #5）
```

---

## 小さい単位で PR を出す

### 大きな PR は避ける

| 項目 | ❌ 大きな PR | ✅ 小さな PR |
|:----|:-----------|:-----------|
| ファイル数 | 10ファイル以上 | 1〜3ファイル |
| 差分行数 | 500行以上 | 100行以下 |
| レビュー時間 | 長い（後回しにされがち） | 短い（すぐ見てもらえる） |
| コンフリクト | 発生しやすい | 発生しにくい |
| バグ発見 | 見逃しやすい | 発見しやすい |

### 小さく分割するコツ

```
コツ：
├── 1つの PR = 1つの目的
├── UI とロジックを分ける
├── まず動くものを作り、後で改善
├── 完璧を求めすぎない
└── "これで一区切り" と思ったら PR
```

---

## コミュニケーションの重要性

### 作業前の確認

```
Slack や Discord で：
├── 「今日は Header.jsx を編集します」
├── 「このファイル触っていいですか？」
├── 「どこまで進んでいますか？」
└── 「先にマージしてもらえますか？」
```

### 定期的な同期

```
毎日の朝会で共有（5分程度）：
├── 昨日やったこと
├── 今日やること
├── 困っていること
├── 誰かと作業が被りそうか
└── マージ待ちの PR はあるか
```

### 被りそうなときの対処

```
対処法：
├── 先に PR を出してもらう
├── 一緒に作業する（ペアプロ）
├── 担当範囲を再調整
└── 大きく変わる場合は事前に相談
```

---

## チームルールの策定

### ルール例

```markdown
## チーム開発ルール

### ブランチ名
- feature/機能名
- fix/バグ内容

### コミットメッセージ
- 日本語で「〜を追加」「〜を修正」

### PR
- 最低1人のレビューで承認
- Draft PR で早めに共有

### コミュニケーション
- 作業開始時に担当を宣言
- 毎朝 main を pull
- 困ったらすぐ相談
```

### ルールを決めるタイミング

プロジェクト開始時にチームで話し合い、README.md や CONTRIBUTING.md に記載しておきましょう。

---

## ミニ演習

### Try 1: プロジェクト構成を考える

以下のアプリを3人で開発する場合、どのようにファイルを分割し、誰が担当するか考えてみましょう。

**アプリ**: Todo リストアプリ（追加・削除・完了機能付き）

```
考えるポイント：
├── どのコンポーネントに分割するか
├── 誰がどこを担当するか
├── 同時に作業しても被らないか
```

### Try 2: チームルールを作成

あなたのチーム用の開発ルールを作成してみましょう。

**テンプレート:**
```markdown
## 開発ルール

### ブランチ名
- 

### コミットメッセージ
- 

### PR のルール
- 

### コミュニケーション
- 
```

---

## まとめ

コンフリクトは設計と運用で大幅に減らせます。

### 予防策まとめ

```
設計面：
├── コンポーネントを細かく分割
├── ファイルごとに担当を明確化
├── 責任範囲を分ける

運用面：
├── こまめに pull・マージ
├── 小さい単位で PR を作成
├── チームでコミュニケーション
├── ルールを決めて共有
```

### ポイント

```
✅ 1ファイル = 1担当 を目指す
✅ 大きな機能は分割する
✅ 毎日 pull する習慣をつける
✅ 困ったらすぐ相談する
```

---

## 次の記事へ

[06-11. .gitignore の使い方](./06-11_gitignoreの使い方.md)
