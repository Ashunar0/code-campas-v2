# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–å…¥é–€ã€ä»»æ„ã€‘

> ğŸ“Œ **ã“ã®è¨˜äº‹ã§å­¦ã¶ã“ã¨**
>
> - React.memo
> - useMemo
> - useCallback
> - æœ€é©åŒ–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

> ğŸ’¡ ã“ã®è¨˜äº‹ã¯**ä»»æ„**ã§ã™ã€‚ã‚¢ãƒ—ãƒªãŒé…ããªã‚‹ã¾ã§ã¯æ°—ã«ã—ãªãã¦ OK ã§ã™ã€‚

## æœ€é©åŒ–ã®å‰ã«

> "Premature optimization is the root of all evil"
> ï¼ˆæ—©ã™ãã‚‹æœ€é©åŒ–ã¯è«¸æ‚ªã®æ ¹æºï¼‰

ã¾ãšã¯**å‹•ãã‚‚ã®ã‚’ä½œã‚‹**ã“ã¨ãŒå¤§äº‹ã§ã™ã€‚
é…ã„ã¨æ„Ÿã˜ãŸã‚‰ã€ãã®ã¨ãã«æœ€é©åŒ–ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚

## å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®åŸºæœ¬

React ã¯ä»¥ä¸‹ã®ã¨ãã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ï¼š

1. **State ãŒå¤‰ã‚ã£ãŸ**ã¨ã
2. **Props ãŒå¤‰ã‚ã£ãŸ**ã¨ã
3. **è¦ªãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**ã—ãŸã¨ã

> ğŸ’¡ **å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° = æ‚ªã„ã“ã¨ï¼Ÿ**
> ã„ã„ãˆï¼React ã¯å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç´ æ—©ã„ã®ã§ã€æ™®é€šã¯æ°—ã«ã—ãªãã¦ OKã€‚
> **å®Ÿéš›ã«é…ã„ã¨æ„Ÿã˜ãŸã¨ã**ã«ã ã‘æœ€é©åŒ–ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚

## React.memo

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®**ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é˜²ã**ã€‚

### å•é¡Œ

```jsx
function Parent() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>+1</button>
      <Child name="ç”°ä¸­" /> {/* count ãŒå¤‰ã‚ã£ã¦ã‚‚å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ */}
    </div>
  );
}

function Child({ name }) {
  console.log("Child ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°");
  return <p>{name}</p>;
}
```

### è§£æ±º

```jsx
const Child = React.memo(function Child({ name }) {
  console.log("Child ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°");
  return <p>{name}</p>;
});
```

`React.memo` ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã¨ã€**Props ãŒå¤‰ã‚ã‚‰ãªã„é™ã‚Šå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã›ã‚“**ã€‚

## useMemo

**è¨ˆç®—çµæœã‚’ãƒ¡ãƒ¢åŒ–**ã™ã‚‹ã€‚

### å•é¡Œ

```jsx
function App({ items }) {
  // æ¯å›è¨ˆç®—ã•ã‚Œã‚‹
  const expensiveResult = items.reduce((sum, item) => sum + item.price, 0);

  return <p>åˆè¨ˆ: {expensiveResult}</p>;
}
```

### è§£æ±º

```jsx
function App({ items }) {
  // items ãŒå¤‰ã‚ã£ãŸã¨ãã ã‘è¨ˆç®—
  const expensiveResult = useMemo(() => {
    return items.reduce((sum, item) => sum + item.price, 0);
  }, [items]);

  return <p>åˆè¨ˆ: {expensiveResult}</p>;
}
```

## useCallback

**é–¢æ•°ã‚’ãƒ¡ãƒ¢åŒ–**ã™ã‚‹ã€‚

### å•é¡Œ

```jsx
function Parent() {
  const [count, setCount] = useState(0);

  // æ¯å›æ–°ã—ã„é–¢æ•°ãŒä½œã‚‰ã‚Œã‚‹
  const handleClick = () => {
    console.log("ã‚¯ãƒªãƒƒã‚¯");
  };

  return <Child onClick={handleClick} />;
  {
    /* æ¯å›å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° */
  }
}
```

### è§£æ±º

```jsx
function Parent() {
  const [count, setCount] = useState(0);

  // é–¢æ•°ã‚’ãƒ¡ãƒ¢åŒ–
  const handleClick = useCallback(() => {
    console.log("ã‚¯ãƒªãƒƒã‚¯");
  }, []);

  return <Child onClick={handleClick} />;
}

const Child = React.memo(function Child({ onClick }) {
  return <button onClick={onClick}>ã‚¯ãƒªãƒƒã‚¯</button>;
});
```

## ã„ã¤ä½¿ã†ã‹

### useMemo

- **é‡ã„è¨ˆç®—**ãŒã‚ã‚‹
- å¤§ããªé…åˆ—ã® filter/map/reduce

### useCallback

- **React.memo ã¨çµ„ã¿åˆã‚ã›**ã¦å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é˜²ã
- **useEffect ã®ä¾å­˜é…åˆ—**ã«é–¢æ•°ã‚’æ¸¡ã™ã¨ã

### React.memo

- Props ãŒ**é »ç¹ã«å¤‰ã‚ã‚‰ãªã„**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚³ã‚¹ãƒˆãŒé«˜ã„**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

## ä½¿ã„ã™ãæ³¨æ„

```jsx
// âŒ éåº¦ãªæœ€é©åŒ–ï¼ˆæ„å‘³ãŒãªã„ã‚±ãƒ¼ã‚¹ï¼‰
const value = useMemo(() => 1 + 1, []);

// â­• æœ¬å½“ã«å¿…è¦ãªã¨ãã ã‘
const filteredItems = useMemo(() => {
  return items.filter((item) => item.price > 1000);
}, [items]);
```

## é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ã®è¨ˆæ¸¬

1. Chrome DevTools â†’ Profiler ã‚¿ãƒ–
2. Record ãƒœã‚¿ãƒ³ã§è¨˜éŒ²é–‹å§‹
3. æ“ä½œã‚’è¡Œã†
4. è¨˜éŒ²åœæ­¢ã—ã¦çµæœã‚’ç¢ºèª

ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‰¹å®šã§ãã¾ã™ã€‚

<!--
ğŸ“¸ ç”»åƒãƒ¡ãƒ¢: React DevTools Profiler ã®ä½¿ã„æ–¹
- Chrome DevTools ã§ Profiler ã‚¿ãƒ–ã‚’é¸æŠ
- Record ãƒœã‚¿ãƒ³ã®ä½ç½®
- ãƒ•ãƒ¬ãƒ¼ãƒ ã‚°ãƒ©ãƒ•ã®è¦‹æ–¹ï¼ˆé•·ã„ãƒãƒ¼ = æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ï¼‰
-->

## ã¾ã¨ã‚

| ãƒ•ãƒƒã‚¯      | ç”¨é€”                   |
| ----------- | ---------------------- |
| React.memo  | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¡ãƒ¢åŒ– |
| useMemo     | è¨ˆç®—çµæœã®ãƒ¡ãƒ¢åŒ–       |
| useCallback | é–¢æ•°ã®ãƒ¡ãƒ¢åŒ–           |

- **ã¾ãšã¯å‹•ãã‚‚ã®ã‚’ä½œã‚‹**
- **é…ããªã£ã¦ã‹ã‚‰**æœ€é©åŒ–ã‚’æ¤œè¨
- **è¨ˆæ¸¬ã—ã¦ã‹ã‚‰**å¯¾ç­–ã™ã‚‹

## ç·´ç¿’å•é¡Œ

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã« `React.memo` ã¨ `useCallback` ã‚’é©ç”¨ã—ã¦ã€ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é˜²ã„ã§ã¿ã¾ã—ã‚‡ã†ï¼š

```jsx
function Parent() {
  const [count, setCount] = useState(0);
  const [text, setText] = useState("");

  const handleClick = () => console.log("ã‚¯ãƒªãƒƒã‚¯");

  return (
    <div>
      <input value={text} onChange={(e) => setText(e.target.value)} />
      <button onClick={() => setCount(count + 1)}>+1: {count}</button>
      <Child onClick={handleClick} />
    </div>
  );
}

function Child({ onClick }) {
  console.log("Child ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°");
  return <button onClick={onClick}>å­ãƒœã‚¿ãƒ³</button>;
}
```

### å›ç­”ä¾‹

```jsx
import { useState, useCallback, memo } from "react";

function Parent() {
  const [count, setCount] = useState(0);
  const [text, setText] = useState("");

  const handleClick = useCallback(() => {
    console.log("ã‚¯ãƒªãƒƒã‚¯");
  }, []);

  return (
    <div>
      <input value={text} onChange={(e) => setText(e.target.value)} />
      <button onClick={() => setCount(count + 1)}>+1: {count}</button>
      <Child onClick={handleClick} />
    </div>
  );
}

const Child = memo(function Child({ onClick }) {
  console.log("Child ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°");
  return <button onClick={onClick}>å­ãƒœã‚¿ãƒ³</button>;
});
```

> ğŸ’¡ `Parent` ã® State ãŒå¤‰ã‚ã£ã¦ã‚‚ `Child` ã¯å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œãªããªã‚Šã¾ã™ã€‚

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒã‚ã‹ã£ãŸã‚‰ã€[ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹](./04-13_ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°.md) ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
