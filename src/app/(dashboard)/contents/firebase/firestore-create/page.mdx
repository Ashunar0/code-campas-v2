
> ğŸ“Œ **ã“ã®è¨˜äº‹ã§å­¦ã¶ã“ã¨**
>
> - addDoc ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
> - setDoc ã¨ã®é•ã„
> - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®è¿½åŠ 

## addDoc ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 

**addDoc** ã‚’ä½¿ã†ã¨ã€è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸ ID ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã§ãã¾ã™ã€‚

```javascript
import { collection, addDoc } from "firebase/firestore";
import { db } from "./lib/firebase";

const addTodo = async (text) => {
  const docRef = await addDoc(collection(db, "todos"), {
    text,
    done: false,
    createdAt: new Date(),
  });
  console.log("è¿½åŠ ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆID:", docRef.id);
  return docRef.id;
};
```

## addDoc vs setDoc

### addDocï¼ˆID è‡ªå‹•ç”Ÿæˆï¼‰

```javascript
// ID ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
await addDoc(collection(db, "todos"), {
  text: "ã‚„ã‚‹ã“ã¨",
});
```

### setDocï¼ˆID ã‚’æŒ‡å®šï¼‰

```javascript
// ID ã‚’è‡ªåˆ†ã§æŒ‡å®šã™ã‚‹
await setDoc(doc(db, "todos", "custom-id"), {
  text: "ã‚„ã‚‹ã“ã¨",
});
```

|      | addDoc     | setDoc         |
| ---- | ---------- | -------------- |
| ID   | è‡ªå‹•ç”Ÿæˆ   | æ‰‹å‹•æŒ‡å®š       |
| ç”¨é€” | é€šå¸¸ã®è¿½åŠ  | ç‰¹å®š ID ã§ä½œæˆ |

## ã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ™‚åˆ»ã§ã¯ãªãã€**ã‚µãƒ¼ãƒãƒ¼ã®æ™‚åˆ»**ã‚’ä½¿ã†ã«ã¯ï¼š

```javascript
import { collection, addDoc, serverTimestamp } from "firebase/firestore";

await addDoc(collection(db, "todos"), {
  text: "ã‚„ã‚‹ã“ã¨",
  done: false,
  createdAt: serverTimestamp(), // ã‚µãƒ¼ãƒãƒ¼ã®æ™‚åˆ»
});
```

### ãƒ¡ãƒªãƒƒãƒˆ

- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ™‚åˆ»è¨­å®šã«ä¾å­˜ã—ãªã„
- å…¨ãƒ‡ãƒ¼ã‚¿ã§ä¸€è²«ã—ãŸæ™‚åˆ»

> ğŸ’¡ **ãªãœ `new Date()` ã§ã¯ãªã `serverTimestamp()` ã‚’ä½¿ã†ã®ï¼Ÿ**
>
> `new Date()` ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® PC ã®æ™‚åˆ»ã‚’ä½¿ã„ã¾ã™ã€‚æ™‚è¨ˆãŒãšã‚Œã¦ã„ã‚‹ã¨ä¸æ­£ç¢ºãªãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚
> `serverTimestamp()` ã¯ Firebase ã‚µãƒ¼ãƒãƒ¼ã®æ™‚åˆ»ã‚’ä½¿ã†ã®ã§ã€å¸¸ã«æ­£ç¢ºã§ã™ã€‚

## React ã§ã®å®Ÿè£…

```jsx
import { useState } from "react";
import { collection, addDoc, serverTimestamp } from "firebase/firestore";
import { db } from "./lib/firebase";

function TodoForm() {
  const [text, setText] = useState("");
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!text.trim()) return;

    setLoading(true);
    try {
      await addDoc(collection(db, "todos"), {
        text,
        done: false,
        createdAt: serverTimestamp(),
      });
      setText("");
    } catch (error) {
      console.error("è¿½åŠ ã‚¨ãƒ©ãƒ¼:", error);
      alert("è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ");
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        value={text}
        onChange={(e) => setText(e.target.value)}
        placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯"
        disabled={loading}
      />
      <button type="submit" disabled={loading}>
        {loading ? "è¿½åŠ ä¸­..." : "è¿½åŠ "}
      </button>
    </form>
  );
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```javascript
try {
  await addDoc(collection(db, "todos"), data);
} catch (error) {
  if (error.code === "permission-denied") {
    console.error("æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“");
  } else {
    console.error("è¿½åŠ ã‚¨ãƒ©ãƒ¼:", error);
  }
}
```

## ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«ã¾ã¨ã‚ã‚‹

```jsx
import { collection, addDoc, serverTimestamp } from "firebase/firestore";
import { db } from "../lib/firebase";

export function useAddTodo() {
  const addTodo = async (text) => {
    const docRef = await addDoc(collection(db, "todos"), {
      text,
      done: false,
      createdAt: serverTimestamp(),
    });
    return docRef.id;
  };

  return { addTodo };
}
```

## ã¾ã¨ã‚

- **addDoc** ã§è‡ªå‹• ID ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
- **setDoc** ã§æŒ‡å®š ID ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
- **serverTimestamp()** ã§ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»ã‚’ä½¿ç”¨
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å¿˜ã‚Œãšã«

## ğŸ¯ ã‚„ã£ã¦ã¿ã‚ˆã†

> ğŸ’¡ **ãƒŸãƒ‹æ¼”ç¿’**
>
> 1. ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã€`addDoc` ã§ Todo ã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†
> 2. Firebase Console ã§ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
> 3. `createdAt` ã« `serverTimestamp()` ã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†
>
> **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: Console ã§ `createdAt` ã®å€¤ãŒæ™‚åˆ»ã«ãªã£ã¦ã„ã‚Œã° OK

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ‡ãƒ¼ã‚¿è¿½åŠ ãŒã§ããŸã‚‰ã€Firestore ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ï¼ˆUpdateï¼‰ ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
