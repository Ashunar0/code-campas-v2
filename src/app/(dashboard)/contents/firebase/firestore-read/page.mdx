
> ğŸ“Œ **ã“ã®è¨˜äº‹ã§å­¦ã¶ã“ã¨**
>
> - å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å–å¾—
> - ç‰¹å®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å–å¾—
> - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼

## å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—

**getDocs** ã§ ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚

```javascript
import { collection, getDocs } from "firebase/firestore";
import { db } from "./lib/firebase";

const fetchTodos = async () => {
  const querySnapshot = await getDocs(collection(db, "todos"));
  const todos = querySnapshot.docs.map((doc) => ({
    id: doc.id,
    ...doc.data(),
  }));
  return todos;
};
```

### ãƒã‚¤ãƒ³ãƒˆ

- `collection(db, "todos")` ã§ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§
- `querySnapshot.docs` ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é…åˆ—ã‚’å–å¾—
- `doc.id` ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ IDã€`doc.data()` ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

> ğŸ’¡ **querySnapshot ã¨ã¯ï¼Ÿ**
>
> ã‚¯ã‚¨ãƒªã®çµæœã‚’åŒ…ã‚“ã ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚`docs` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é…åˆ—ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚
> å„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ `doc.id`ï¼ˆIDï¼‰ã¨ `doc.data()`ï¼ˆãƒ‡ãƒ¼ã‚¿ï¼‰ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

## React ã§ã®å®Ÿè£…

```jsx
import { useState, useEffect } from "react";
import { collection, getDocs } from "firebase/firestore";
import { db } from "./lib/firebase";

function TodoList() {
  const [todos, setTodos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchTodos = async () => {
      try {
        const querySnapshot = await getDocs(collection(db, "todos"));
        const todosData = querySnapshot.docs.map((doc) => ({
          id: doc.id,
          ...doc.data(),
        }));
        setTodos(todosData);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchTodos();
  }, []);

  if (loading) return <p>èª­ã¿è¾¼ã¿ä¸­...</p>;
  if (error) return <p>ã‚¨ãƒ©ãƒ¼: {error}</p>;

  return (
    <ul>
      {todos.map((todo) => (
        <li key={todo.id}>{todo.text}</li>
      ))}
    </ul>
  );
}
```

## ç‰¹å®šã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—

**getDoc** ã§ ç‰¹å®šã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚

```javascript
import { doc, getDoc } from "firebase/firestore";
import { db } from "./lib/firebase";

const fetchTodo = async (id) => {
  const docRef = doc(db, "todos", id);
  const docSnap = await getDoc(docRef);

  if (docSnap.exists()) {
    return { id: docSnap.id, ...docSnap.data() };
  } else {
    throw new Error("ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“");
  }
};
```

## ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼

**onSnapshot** ã‚’ä½¿ã†ã¨ã€ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚ŒãŸã¨ãã«è‡ªå‹•ã§å†å–å¾—ã•ã‚Œã¾ã™ã€‚

```jsx
import { useState, useEffect } from "react";
import { collection, onSnapshot } from "firebase/firestore";
import { db } from "./lib/firebase";

function TodoList() {
  const [todos, setTodos] = useState([]);

  useEffect(() => {
    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
    const unsubscribe = onSnapshot(collection(db, "todos"), (snapshot) => {
      const todosData = snapshot.docs.map((doc) => ({
        id: doc.id,
        ...doc.data(),
      }));
      setTodos(todosData);
    });

    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼šãƒªã‚¹ãƒŠãƒ¼ã‚’è§£é™¤
    return () => unsubscribe();
  }, []);

  return (
    <ul>
      {todos.map((todo) => (
        <li key={todo.id}>{todo.text}</li>
      ))}
    </ul>
  );
}
```

### ãªãœãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼ãŒå¿…è¦ï¼Ÿ

ä¾‹ãˆã°ã€è¤‡æ•°äººã§åŒã˜ Todo ãƒªã‚¹ãƒˆã‚’å…±æœ‰ã—ã¦ã„ã‚‹å ´åˆã€ä»–ã®äººãŒ Todo ã‚’è¿½åŠ ã™ã‚‹ã¨è‡ªåˆ†ã®ç”»é¢ã«ã‚‚å³åº§ã«åæ˜ ã•ã‚Œã¾ã™ã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼ã®ãƒ¡ãƒªãƒƒãƒˆ

- ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ›´æ–°ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚‚å³åº§ã«åæ˜ 
- æ‰‹å‹•ã§å†å–å¾—ã™ã‚‹å¿…è¦ãŒãªã„

### æ³¨æ„ç‚¹

- ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã§**å¿…ãš unsubscribe** ã™ã‚‹
- ãƒªã‚¹ãƒŠãƒ¼ãŒå¤šã„ã¨ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹

## getDocs vs onSnapshot

|                  | getDocs      | onSnapshot   |
| ---------------- | ------------ | ------------ |
| å–å¾—ã‚¿ã‚¤ãƒŸãƒ³ã‚°   | 1 å›ã ã‘     | ç¶™ç¶šçš„ã«ç›£è¦– |
| ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–° | âŒ           | â­•           |
| ã‚³ã‚¹ãƒˆ           | ä½ã„         | ã‚„ã‚„é«˜ã„     |
| ç”¨é€”             | é™çš„ãªãƒ‡ãƒ¼ã‚¿ | å‹•çš„ãªãƒ‡ãƒ¼ã‚¿ |

## ã¾ã¨ã‚

- **getDocs**ï¼šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ 1 å›å–å¾—
- **getDoc**ï¼šç‰¹å®šã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ 1 å›å–å¾—
- **onSnapshot**ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¤‰æ›´ã‚’ç›£è¦–
- React ã§ã¯ useEffect å†…ã§å–å¾—

## ğŸ¯ ã‚„ã£ã¦ã¿ã‚ˆã†

> ğŸ’¡ **ãƒŸãƒ‹æ¼”ç¿’**
>
> 1. `getDocs` ã‚’ä½¿ã£ã¦ Firebase Console ã§è¿½åŠ ã—ãŸ `todos` ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†
> 2. `onSnapshot` ã«å¤‰æ›´ã—ã¦ã€Console ã§ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚‹ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
> 3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†
>
> **ãƒ’ãƒ³ãƒˆ**: `console.log(todos)` ã§ãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«ã‚’ç¢ºèªã§ãã¾ã™

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒã§ããŸã‚‰ã€Firestore ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ï¼ˆCreateï¼‰ ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
