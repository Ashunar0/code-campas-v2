# useEffect ã®åŸºç¤

> ğŸ“Œ **ã“ã®è¨˜äº‹ã§å­¦ã¶ã“ã¨**
>
> - useEffect ã¨ã¯ä½•ã‹
> - ä¾å­˜é…åˆ—ã®ä½¿ã„æ–¹
> - ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°
> - ã‚ˆãã‚ã‚‹ä½¿ç”¨ä¾‹

## useEffect ã¨ã¯ï¼Ÿ

**useEffect** ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®**å‰¯ä½œç”¨ï¼ˆside effectï¼‰** ã‚’æ‰±ã†ãŸã‚ã®ãƒ•ãƒƒã‚¯ã§ã™ã€‚

å‰¯ä½œç”¨ã¨ã¯ï¼š

- API ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹
- DOM ã‚’ç›´æ¥æ“ä½œã™ã‚‹
- ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®šã™ã‚‹
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´ã™ã‚‹

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

```jsx
import { useState, useEffect } from "react";

function App() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log("useEffect ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸ");
  });

  return (
    <div>
      <p>ã‚«ã‚¦ãƒ³ãƒˆ: {count}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  );
}
```

## ä¾å­˜é…åˆ—

useEffect ã®**ç¬¬ 2 å¼•æ•°**ã«ä¾å­˜é…åˆ—ã‚’æ¸¡ã™ã“ã¨ã§ã€ã„ã¤å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚

### ãƒ‘ã‚¿ãƒ¼ãƒ³ 1: æ¯å›å®Ÿè¡Œï¼ˆä¾å­˜é…åˆ—ãªã—ï¼‰

```jsx
useEffect(() => {
  console.log("æ¯å›å®Ÿè¡Œã•ã‚Œã‚‹");
});
```

> âš ï¸ ç„¡é™ãƒ«ãƒ¼ãƒ—ã«ãªã‚Šã‚„ã™ã„ã®ã§ã€é€šå¸¸ã¯é¿ã‘ã¾ã™ã€‚

### ãƒ‘ã‚¿ãƒ¼ãƒ³ 2: åˆå›ã®ã¿å®Ÿè¡Œï¼ˆç©ºã®ä¾å­˜é…åˆ—ï¼‰

```jsx
useEffect(() => {
  console.log("åˆå›ã®ã¿å®Ÿè¡Œã•ã‚Œã‚‹");
}, []); // ç©ºã®é…åˆ—
```

æœ€ã‚‚ã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

### ãƒ‘ã‚¿ãƒ¼ãƒ³ 3: ç‰¹å®šã®å€¤ãŒå¤‰ã‚ã£ãŸã‚‰å®Ÿè¡Œ

```jsx
useEffect(() => {
  console.log(`count ãŒ ${count} ã«å¤‰ã‚ã£ãŸ`);
}, [count]); // count ãŒå¤‰ã‚ã£ãŸã‚‰å®Ÿè¡Œ
```

```jsx
useEffect(() => {
  console.log("name ã¾ãŸã¯ age ãŒå¤‰ã‚ã£ãŸ");
}, [name, age]); // è¤‡æ•°ã®å€¤ã‚’ç›£è¦–
```

## ä¾å­˜é…åˆ—ã®ã¾ã¨ã‚

| ä¾å­˜é…åˆ—  | å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°         |
| --------- | ---------------------- |
| ãªã—      | æ¯å›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚     |
| `[]`      | åˆå›ã®ã¿ï¼ˆãƒã‚¦ãƒ³ãƒˆæ™‚ï¼‰ |
| `[value]` | value ãŒå¤‰ã‚ã£ãŸã¨ã   |

## å®Ÿè·µä¾‹ï¼šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã®å¤‰æ›´

```jsx
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `ã‚«ã‚¦ãƒ³ãƒˆ: ${count}`;
  }, [count]);

  return (
    <div>
      <p>ã‚«ã‚¦ãƒ³ãƒˆ: {count}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  );
}
```

ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ãƒ–ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒã€Œã‚«ã‚¦ãƒ³ãƒˆ: 3ã€ã®ã‚ˆã†ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

## ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°

useEffect ã®ä¸­ã§**return**ã™ã‚‹ã¨ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’å®šç¾©ã§ãã¾ã™ã€‚

```jsx
useEffect(() => {
  // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  const timer = setInterval(() => {
    console.log("1ç§’çµŒé");
  }, 1000);

  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  return () => {
    clearInterval(timer);
  };
}, []);
```

### ã„ã¤å®Ÿè¡Œã•ã‚Œã‚‹ï¼Ÿ

- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ã¨ã
- ä¾å­˜é…åˆ—ã®å€¤ãŒå¤‰ã‚ã£ã¦ã€æ¬¡ã® effect ãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰

### ãªãœå¿…è¦ï¼Ÿ

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ãªã„ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ã‚„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒæ®‹ã‚Šç¶šã‘ã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®åŸå› ã«ãªã‚Šã¾ã™ã€‚

## å®Ÿè·µä¾‹ï¼šã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼

```jsx
function WindowSize() {
  const [width, setWidth] = useState(window.innerWidth);

  useEffect(() => {
    const handleResize = () => {
      setWidth(window.innerWidth);
    };

    // ãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²
    window.addEventListener("resize", handleResize);

    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒªã‚¹ãƒŠãƒ¼ã‚’è§£é™¤ï¼‰
    return () => {
      window.removeEventListener("resize", handleResize);
    };
  }, []);

  return <p>ç”»é¢å¹…: {width}px</p>;
}
```

## useEffect ã§ã® API å–å¾—

```jsx
function PokemonInfo() {
  const [pokemon, setPokemon] = useState(null);

  useEffect(() => {
    const fetchPokemon = async () => {
      const response = await fetch("https://pokeapi.co/api/v2/pokemon/25");
      const data = await response.json();
      setPokemon(data);
    };

    fetchPokemon();
  }, []);

  if (!pokemon) {
    return <p>èª­ã¿è¾¼ã¿ä¸­...</p>;
  }

  return (
    <div>
      <h1>{pokemon.name}</h1>
      <img src={pokemon.sprites.front_default} alt={pokemon.name} />
    </div>
  );
}
```

## ã‚ˆãã‚ã‚‹é–“é•ã„

### 1. ä¾å­˜é…åˆ—ã‚’å¿˜ã‚Œã‚‹

```jsx
// âŒ ç„¡é™ãƒ«ãƒ¼ãƒ—ã«ãªã‚‹å¯èƒ½æ€§
useEffect(() => {
  fetchData();
});

// â­• ä¾å­˜é…åˆ—ã‚’æŒ‡å®š
useEffect(() => {
  fetchData();
}, []);
```

### 2. ä¾å­˜é…åˆ—ã«å¿…è¦ãªå€¤ã‚’å…¥ã‚Œå¿˜ã‚Œã‚‹

```jsx
// âš ï¸ è­¦å‘ŠãŒå‡ºã‚‹ï¼ˆuserId ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã«ä¾å­˜é…åˆ—ã«ãªã„ï¼‰
useEffect(() => {
  fetchUser(userId);
}, []);

// â­• ä¾å­˜é…åˆ—ã«è¿½åŠ 
useEffect(() => {
  fetchUser(userId);
}, [userId]);
```

## ã¾ã¨ã‚

- **useEffect** ã¯å‰¯ä½œç”¨ã‚’æ‰±ã†ãƒ•ãƒƒã‚¯
- **ä¾å­˜é…åˆ—**ã§å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡
  - `[]`ï¼šåˆå›ã®ã¿
  - `[value]`ï¼švalue ãŒå¤‰ã‚ã£ãŸã¨ã
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°**ã§ã‚¿ã‚¤ãƒãƒ¼ã‚„ãƒªã‚¹ãƒŠãƒ¼ã‚’è§£é™¤
- API å–å¾—ã¯ `useEffect` + `async/await`

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

useEffect ãŒã‚ã‹ã£ãŸã‚‰ã€[API ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹](./03-11_APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹.md) ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
